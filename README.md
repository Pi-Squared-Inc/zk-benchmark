# Goal

This file contains information on the measurements that we have taken when running our [Metamath](https://us.metamath.org/) (MM) proof checker
on different Metamath files in various zero-knowledge Virtual Machines (zkVMs).

# Our experiment

The list of zkVMs that we are considering is the following one:
- [Risc0](https://github.com/risc0/risc0)
- [zkWASM](https://github.com/DelphinusLab/zkWasm)
- [Jolt](https://github.com/a16z/jolt)
- [Cairo](https://docs.cairo-lang.org/)
- [SP1](https://github.com/succinctlabs/sp1)
- [Lurk](https://github.com/argumentcomputer/lurk-beta)
- [Nexus](https://github.com/nexus-xyz/nexus-zkvm)

The implementations of our Metamath proof checker in each of the above zkVMs can be found in the [checker/mm](https://github.com/Pi-Squared-Inc/pi2/tree/main/checker/mm) folder in the main pi2 repo. They each consist of a guest program which runs on the specific virtual machine and a host program which is our interface to actually running the guest, providing input for it and processing its output. The Metamath files that we are testing can be found in the mm-files folder.

Out of the seven zkVMs that we are considering only Risc0, zkWASM, SP1 and Cairo provide GPU support. Still, we were only able to run Risc0 and zkWASM with GPU support because of some internal setup issues. 

We run our experiment on more than 1000 Metamath files with various input sizes, where the input size of a Metamath file is the number of its containing symbols (tokens). 
There were two main classes of benchmarks, which reflect both general MM files, but also the MM files that we generate internally. For one of them, we took the Metamath file [hol.mm](https://github.com/metamath/set.mm/blob/develop/hol.mm) from the Metamath database [set.mm](https://github.com/metamath/set.mm/tree/develop) database, and sliced it into small sublemmas, in order to create many Metamath files with few tokens.
The other class of benchmarks was for real proofs of execution generated by the Pi Squared's Math Proof Generation pipeline, more specifically the mock ERC20 transfer written in the IMP programming language. If you want to find more on how we generate mathematical proofs of program executions, check out [our website](https://docs.pi2.network/).


# How to run our tests 

## Docker set up 

[Insert instructions]

## Instructions to run all MM files with all zkVMs

[Insert instructions]

## Instructions to run a single MM file with a zkVM

[Insert instructions]

# Our results


For the smallest file, hol_idi.mm, which consists of ... tokens, Nexus proving time is 512 seconds.
[insert other info for zkvms that will not be shown in the table]


## Proof file size VS CPU proof time

![MM-proof file size vs ZK-proof time](img/tokens_prover.svg "MM-proof file size vs ZK-proof time")

## ZK Backends

Measurements taken on a **AMD EPYC 9354 32-Core CPU (64 threads)**, with **4x NVIDIA GeForce RTX 4090 24GB GPU's** and **248GB RAM**.

All times below are measured in seconds.

## ZK Backends
### Cairo
| Benchmark                                                                         |   Input size |   Proving time |   Verification time |
|:----------------------------------------------------------------------------------|-------------:|---------------:|--------------------:|
| [hol_idi.mm](mm-files/hol_idi.mm)                                                 |           39 |          0.913 |               0.029 |
| [hol_wov.mm](mm-files/hol_wov.mm)                                                 |          147 |          5.975 |               0.229 |
| [hol_ax13.mm](mm-files/hol_ax13.mm)                                               |          508 |         25.623 |               0.993 |
| [hol_cbvf.mm](mm-files/hol_cbvf.mm)                                               |         1786 |        110.230 |               4.321 |
| [45.erc20transfer_success_tm_0_6.mm](mm-files/45.erc20transfer_success_tm_0_6.mm) |         6249 |        228.487 |               9.102 |
| [25.erc20transfer_success_tm_0_9.mm](mm-files/25.erc20transfer_success_tm_0_9.mm) |        21332 |        nan     |             nan     |
| [3.erc20transfer_success_tm_0.mm](mm-files/3.erc20transfer_success_tm_0.mm)       |        73862 |        nan     |             nan     |
| [9.erc20transfer_success.mm](mm-files/9.erc20transfer_success.mm)                 |       258135 |        nan     |             nan     |

### Jolt
| Benchmark                                                                         |   Input size |   Proving time |   Verification time |
|:----------------------------------------------------------------------------------|-------------:|---------------:|--------------------:|
| [hol_idi.mm](mm-files/hol_idi.mm)                                                 |           39 |          3.170 |               0.174 |
| [hol_wov.mm](mm-files/hol_wov.mm)                                                 |          147 |          5.350 |               0.156 |
| [hol_ax13.mm](mm-files/hol_ax13.mm)                                               |          508 |         10.290 |               0.229 |
| [hol_cbvf.mm](mm-files/hol_cbvf.mm)                                               |         1786 |         28.530 |               0.194 |
| [45.erc20transfer_success_tm_0_6.mm](mm-files/45.erc20transfer_success_tm_0_6.mm) |         6249 |         30.000 |               0.200 |
| [25.erc20transfer_success_tm_0_9.mm](mm-files/25.erc20transfer_success_tm_0_9.mm) |        21332 |         91.870 |               0.218 |
| [3.erc20transfer_success_tm_0.mm](mm-files/3.erc20transfer_success_tm_0.mm)       |        73862 |        nan     |             nan     |
| [9.erc20transfer_success.mm](mm-files/9.erc20transfer_success.mm)                 |       258135 |        nan     |             nan     |

### RISC0 (GPU)
| Benchmark                                                                         |   Input size |   Proving time |   Verification time |
|:----------------------------------------------------------------------------------|-------------:|---------------:|--------------------:|
| [hol_idi.mm](mm-files/hol_idi.mm)                                                 |           39 |          0.443 |               0.016 |
| [hol_wov.mm](mm-files/hol_wov.mm)                                                 |          147 |          0.553 |               0.017 |
| [hol_ax13.mm](mm-files/hol_ax13.mm)                                               |          508 |          0.769 |               0.018 |
| [hol_cbvf.mm](mm-files/hol_cbvf.mm)                                               |         1786 |          2.070 |               0.035 |
| [45.erc20transfer_success_tm_0_6.mm](mm-files/45.erc20transfer_success_tm_0_6.mm) |         6249 |          2.090 |               0.035 |
| [25.erc20transfer_success_tm_0_9.mm](mm-files/25.erc20transfer_success_tm_0_9.mm) |        21332 |          3.950 |               0.053 |
| [3.erc20transfer_success_tm_0.mm](mm-files/3.erc20transfer_success_tm_0.mm)       |        73862 |         15.990 |               0.225 |
| [9.erc20transfer_success.mm](mm-files/9.erc20transfer_success.mm)                 |       258135 |         63.740 |               0.885 |

### RISC0 (CPU)
| Benchmark                                                                         |   Input size |   Proving time |   Verification time |
|:----------------------------------------------------------------------------------|-------------:|---------------:|--------------------:|
| [hol_idi.mm](mm-files/hol_idi.mm)                                                 |           39 |          3.140 |               0.016 |
| [hol_wov.mm](mm-files/hol_wov.mm)                                                 |          147 |          5.770 |               0.017 |
| [hol_ax13.mm](mm-files/hol_ax13.mm)                                               |          508 |         11.220 |               0.018 |
| [hol_cbvf.mm](mm-files/hol_cbvf.mm)                                               |         1786 |         33.900 |               0.035 |
| [45.erc20transfer_success_tm_0_6.mm](mm-files/45.erc20transfer_success_tm_0_6.mm) |         6249 |         33.480 |               0.035 |
| [25.erc20transfer_success_tm_0_9.mm](mm-files/25.erc20transfer_success_tm_0_9.mm) |        21332 |         66.280 |               0.053 |
| [3.erc20transfer_success_tm_0.mm](mm-files/3.erc20transfer_success_tm_0.mm)       |        73862 |        276.440 |               0.225 |
| [9.erc20transfer_success.mm](mm-files/9.erc20transfer_success.mm)                 |       258135 |       1635.040 |               2.070 |

### SP1
| Benchmark                                                                         |   Input size |   Proving time |   Verification time |
|:----------------------------------------------------------------------------------|-------------:|---------------:|--------------------:|
| [hol_idi.mm](mm-files/hol_idi.mm)                                                 |           39 |          7.260 |               0.203 |
| [hol_wov.mm](mm-files/hol_wov.mm)                                                 |          147 |         12.220 |               0.199 |
| [hol_ax13.mm](mm-files/hol_ax13.mm)                                               |          508 |         17.450 |               0.199 |
| [hol_cbvf.mm](mm-files/hol_cbvf.mm)                                               |         1786 |         34.860 |               0.208 |
| [45.erc20transfer_success_tm_0_6.mm](mm-files/45.erc20transfer_success_tm_0_6.mm) |         6249 |         34.790 |               0.207 |
| [25.erc20transfer_success_tm_0_9.mm](mm-files/25.erc20transfer_success_tm_0_9.mm) |        21332 |         43.340 |               0.338 |
| [3.erc20transfer_success_tm_0.mm](mm-files/3.erc20transfer_success_tm_0.mm)       |        73862 |        133.150 |               0.731 |
| [9.erc20transfer_success.mm](mm-files/9.erc20transfer_success.mm)                 |       258135 |        456.790 |               2.490 |


[Insert graph]

We selected eight representative files [how did we select them?] and choose to present their corresponding statistics.

[insert table for each file]

# Disclaimers
We believe there are several reasons why our code may be improved.
- some of the zkVMs that we are considering (e.g. Jolt, Nexus) are still under active development and our corresponding proof 
checker implementations could benefit from future improvements. 
- we are building the Cairo prover from an old [commit](https://github.com/lambdaclass/lambdaworks/tree/a591186e6c4dd53301b03b4ddd69369abe99f960/provers).
- some of the zkVMs (Cairo, Lurk) are using specialized languages which opens up potential for optimizations 
unique to their particular languages.

All the implementations could actually benefit from hand crafted optimizations, since the zkVM field is such an active research field. 
We are describing one of the optimizations that our team has worked on in the next section.

If you have any ideas for improvements or spot areas that could be optimized, don't hesitate to jump in. We welcome contributions! 

# One possible optimization
[if we have time to generate numbers, talk about Brandon's optimization: what it is and how it improves]
